pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
-- flashlight shader
-- from freds72
-- based on krajzek articles
local shade={}
function scol(i)
	return sget(2*flr(i/8)+1,i%8)
end
for i=0,15 do
	local c1=scol(i)
	for j=0,15 do
		shade[bor(i,shl(j,4))]=bor(c1,shl(scol(j),4))
	end
end

darken=function(r,i,j)
	local rmin,rmax=r,1.3*r
	-- even boundary
	local ii=2*flr(i/2)
	-- circle extent
	local ymin,ymax=mid(flr(j-rmax),0,127),mid(flr(j+rmax),0,127)
	-- screen address
	local m=0x6000
	-- clear upper part
	for y=0,ymin-1 do
		memset(m,0,64)
		m+=64
	end
	
	-- draw shaded circle
	for y=ymin,ymax do
		-- 0-centered
		y-=j
		-- squared
		y*=y
		-- outer radius
		local xmax=rmax*rmax-y
		-- inner radius
		local xmin=rmin*rmin-y
		
		-- note: selected solution is negative
		xmax=xmax>=0 and flr(shr(i-sqrt(xmax),1)) or flr(i/2)
		xmin=xmin>=0 and flr(shr(i-sqrt(xmin),1)) or flr(i/2)
		
		-- clear left/right
		memset(m,0,max(xmax)+1)
		memset(m+min(ii-xmax+1,63),0,max(64+xmax-ii-1))
		
		-- draw inner shade
		for x=xmax+1,xmin do
			if(x>=0 and x<64) poke(m+x,shade[shade[peek(m+x)]])
			x=ii-x+1
			if(x>=0 and x<64) poke(m+x,shade[shade[peek(m+x)]])
		end	
		m+=64
	end
	for y=ymax+1,127 do
		memset(m,0,64)
		m+=64
	end	
end

function _init()
	-- mouse support
	poke(0x5f2d,1)
end

function _update()
end

function _draw()
 palt(0,false)
	map(0,0)
	palt()
	
	local x,y=stat(32),stat(33)
	darken(16,x,y)

	print(stat(1),2,2,7)
end
__gfx__
0082018f999199996661666699000009906000606660666600000000000000000000000000000000000000000000000000000000000000000000000000000000
10941d9a449144446615166640445440402222206605066611010111000000000000000000000000000000000000000000000000000000000000000000000000
21a92ea7111111116155516610095900108000806666666610111011000000000000000000000000000000000000000000000000000000000000000000000000
31b33bb6999991991555551690440440908080800066606655555556000000000000000000000000000000000000000000000000000000000000000000000000
45c149c7444491446555556640956590408888806560056665555566000000000000000000000000000000000000000000000000000000000000000000000000
51d156d6111111116655566610045400108808806665566666555666000000000000000000000000000000000000000000000000000000000000000000000000
65e267ef999199996665666690995990902050206665666666656666000000000000000000000000000000000000000000000000000000000000000000000000
76fd77f7449144446666666640000000400111006666666666666666000000000000000000000000000000000000000000000000000000000000000000000000
11111119aaaaaaaa91111111aaaaaaaa111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000
11111119a111111a9111111111111111111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000
11111119911111199111111111111111111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000
11111119911111199111111111111111111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000
11111119911111199111111111111111111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000
11111119911111199111111111111111111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000
11111119411111149111111111111111111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000
11111119444444449111111111111111111111114444444400000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777000007700777077707700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00707000000700707070700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00707000000700777077700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00707000000700707000700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777007007770777000707770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000111000001100000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000010000000100000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000100000111000001110000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000011110001111100011111000100000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000001111111011111110111111101111000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000001111111166666666666611111111000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000101111116166666661666666101111110000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000111661516666615166666150111110000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000011615551666155516661550011100000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000016155555161555551615555501000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000010000066655555666555556665555511100000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000011005666665556666655566666555666110000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000001111106666666566666665666666656666111011000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000001111116666666666666666666666666666111111000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000001111106666666166666661666666616666111011000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000001111151666661516666615166666151666660001000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000001110555166615551666155516661555166610000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000100555516155555161555551615555516150000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000001110555566655555666555556665555566650000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000001111555666665556666655566666555666660001000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000001111656666666566666665666666656666661011000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000001111666666666666666666666666666666661111000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000001111616666aaaaaaaa6661666666616666661011000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000001111151666a111111a6615166666151666660001000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000001110555166911111196155516661555166610000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000100555516911111191555551615555516150000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000001110005566911111196555556665555566100000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000001111005666911111196655566666555666110001000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000001111106666411111146665666666656666111011000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000011116666444444446666666666666666111100000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000011101166906000606661666666616611111000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000011000166402222206615166666151611110000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000011108000806155516661550011100000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000001908080801555551615550001000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000011108888806555556665000011100000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000111001108806655566611000111000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000001111500000001110111111101111000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000011100000001111111111111100000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000001110111111100000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000001100011111000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000001000001100000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

__map__
1415151515151515151515151515151400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1001010101030101010301010101011200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1006060606060606060606060606061200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1002020202020202020202050202021200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1002020202020202020202020202021200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1002020202020202020202020202021200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1002020211020202020502020205021200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1002020204020202020202020202021200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1002020206020202020202020202021200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1002020202020202020202020202021200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1002020202020202020211020202021200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1002020205020505020204020202021200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1002020205020205020206020202021200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1002020205050502020202020202021200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1002020202020202020202020202021200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1002020202020202020202020202021200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1002020202020202020202020202021200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
