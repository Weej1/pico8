pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
cam={}
cam.x=0
cam.y=16
cam.z=0
hh=128/2
hw=128/2
body={9,5,7}
body_i=2
grass={3,11}
fadetable={
 {0,0,1,1,5,5,5,13,13,13,6,6,6,6,7},
 {1,1,5,5,13,13,13,13,13,6,6,6,6,6,7},
 {2,2,2,13,13,13,13,13,6,6,6,6,6,7,7},
 {3,3,3,3,13,13,13,13,6,6,6,6,6,7,7},
 {4,4,4,4,4,14,14,14,15,15,15,15,15,7,7},
 {5,5,13,13,13,13,13,6,6,6,6,6,6,7,7},
 {6,6,6,6,6,6,6,6,7,7,7,7,7,7,7},
 {7,7,7,7,7,7,7,7,7,7,7,7,7,7,7},
 {8,8,8,8,14,14,14,14,14,14,15,15,15,7,7},
 {9,9,9,10,10,10,15,15,15,15,15,15,15,7,7},
 {10,10,10,10,10,15,15,15,15,15,15,15,7,7,7},
 {11,11,11,11,11,11,6,6,6,6,6,6,6,7,7},
 {12,12,12,12,12,12,6,6,6,6,6,6,7,7,7},
 {13,13,13,13,6,6,6,6,6,6,6,6,7,7,7},
 {14,14,14,14,14,15,15,15,15,15,15,7,7,7,7},
 {15,15,15,15,15,15,15,7,7,7,7,7,7,7,7}
}

t=0
function _update()
	t+=1
	body_i=2
	if(btn(0)) cam.x-=1 body_i=1
	if(btn(1)) cam.x+=1 body_i=3	
	if(btn(2)) cam.y-=1
	if(btn(3)) cam.y+=1	
	if(btn(4)) cam.z-=0.05
	if(btn(5)) cam.z+=0.05	
end
function _draw()
	map(0,0,0,5,16,16)
	palt(0,false)
	palt(3,true)
	local tone=1
	local c,x,y,z,w,xmax
	for i=1,63 do
		z=-cam.y/(i-hh)
		w=1/z
		-- local tone=min(15-max(flr(15*w+0.5),1),15)
		z+=cam.z/2
		xmax=flr(8*w+0.5)
		x=hw-xmax-cam.x*w
		c=grass[band(flr(z*2),1)+1]
		c=fadetable[c+1][1]
		if(c==3) then
			local j=128-i
			line(0,j,x,128-i,c)
			line(x+2*xmax,j,127,j,c)
			--line(0,j,127,j,c)
		end
		if (2*xmax<32) then
			sspr(72,32+band(flr(8*z),15),16,1,x,128-i,2*xmax,1)
		else
			sspr(8,band(flr(16*z),31),32,1,x,128-i,2*xmax,1)
		end
	end
	-- clouds
	for i=1,56 do
		z=-(64-cam.y)/(i-hh)
		w=1/z
		z+=cam.z/2
		xmax=flr(96*w+0.5)
		x=hw-xmax-cam.x*w
		sspr(0,32+band(flr(16*z),31),32,1,x,i,2*xmax,1)
	end
	map(16,0,0,5,16,8)
		
	local s=band(t,1)
	if(body_i==2) then
		--if(s==0) spr(53,64-8-10,56,2,1,false)
		--if(s==1) spr(53,64-8+8,55,2,1,true,true)
		--if(s==2) spr(53,64-8+8,56,2,1,true)
		--if(s==3) spr(53,64-8-10,55,2,1,false,true)
		if(s==0) spr(53,64-8-10,56,2,1)
		if(s==1) spr(53,64-8+8,56,2,1,true)
	end
	if(body_i==3) then
		if(s==0) spr(55,64+2,58,2,1)
		if(s==1) spr(55,64+8-24,51,2,1,true,true)
	end
	if(body_i==1) then
		if(s==0) spr(55,64+2-20,58,2,1,true)
		if(s==1) spr(55,64+8-8,51,2,1,false,true)
	end
	
	if (s==0) then
		spr(57,64-8,64+3*cam.y)
		spr(57,64,64+3*cam.y,1,1,true)
	end
	spr(body[body_i],64-8,56,2,3)
	palt()
	rectfill(0,0,127,7,1)
	print("cpu:"..flr(100*stat(1)+0.5).."%",1,1,7)
end
__gfx__
00000000077755555555555775555555555577703333330133333333333333333133333333333303333333333333333033333333b3b3b3b30000000000000000
000000000777555555555557755555555555777033333301333333333333333301333333333333013333333333333330133333333b3b3b3b0000000000000000
00700700077755555555555555555555555577703333330133333333333333330133333333333301333333333333333013333333b3b3b3b30000000000000000
000770000777555555555555555555555555777033333301333333333333333301333333333333013333333333333330133333333b3b3b3b0000000000000000
00077000088855555555555555555555555588803333330133333333333333330133333333333301333333333333333013333333b3b3b3b30000000000000000
007007000888555555555555555555555555888033333301333333333336336301333333333333013633633333333330136336333b3b3b3b0000000000000000
00000000088855555555555555555555555588803333630136333333333633601133333333333300163363333333333001633633b3b3b3b30000000000000000
000000000888555555555557755555555555888036336101163363333336301013633333333336301013633333333363010136333b3b3b3b0000000000000000
cccccccc0777555555555557755555555555777036330101113363333366600011633333333336001116663333333360011166637b7b7b7b0000000000000000
cccccccc077755555555555775555555555577703633000111336333336006601113333333333000166006333333330001660063b7b7b7b70000000000000000
cccccccc077755555555555775555555555577703666660166666333336330001113363333633000100336333336330001003363bbbbbbbb0000000000000000
cccccccc0777555555555557755555555555777036000001000063333333000116633633336336600111333333363366001113337b7b7b7b0000000000000000
cccccccc088855555555555555555555555588803633000111336333333300011006663333666000011133333336660000111333bbbbbbbb0000000000000000
cccccccc0888555555555555555555555555888036300001110363333333300011106333333600001113333333336000011133333b3b3b3b0000000000000000
cccccccc088855555555555555555555555588803630000011036333333300001103633333363000110033333333630001100333b3b3b3b30000000000000000
cccccccc0888555555555555555555555555888033330000113333333300301111036333333630000003003333336300000030033b3b3b3b0000000000000000
cccccccc077755555555555555555555555577703333001110333333330330001333333333333331000330333333333310003303c3c3c3c30000000000000000
7ccc7ccc0777555555555555555555555555777033303000030333333333300000333333333333000003333333333330000033333c3c3c3c0000000000000000
cccccccc077755555555555555555555555577703303300003303333333333300303333333333030033333333333330300333333c3c3c3c30000000000000000
cccccccc0777555555555557755555555555777033033333333033333333333333303333333303333333333333333033333333333c3c3c3c0000000000000000
c7c7c7c7088855555555555775555555555588803333333333333333333333333330333333330333333333333333303333333333c3c3c3c30000000000000000
cccccccc0888555555555557755555555555888033333333333333333333333333333333333333333333333333333333333333333c3c3c3c0000000000000000
7c7c7c7c088855555555555775555555555588803333333333333333333333333333333333333333333333333333333333333333c3c3c3c30000000000000000
c7c7c7c70888555555555557755555555555888033333333333333333333333333333333333333333333333333333333333333333c3c3c3c0000000000000000
77777777077755555555555775555555555577703333333333333333003333333333333333333333333333333333333333333333000000000000000000000000
77777777077755555555555555555555555577703333333333333333000033333333333333333333333333333333333333333333000000000000000000000000
77777777077755555555555555555555555577703333333333333333330000333333333333333333333333333333333333333333000000000000000000000000
77777777077755555555555555555555555577700000000000000000330033003333333333300000333333333333333333333333000000000000000000000000
77777777088855555555555555555555555588803333333333330000333300330033333330000000333333333333333333333333000000000000000000000000
77777777088855555555555555555555555588803333333300000033333333003300333300000000333333333333333333333333000000000000000000000000
77777777088855555555555775555555555588803333333333333333333333333333003330000000333333333333333333333333000000000000000000000000
77777777088855555555555775555555555588803333333333333333333333333333333333300000333333333333333333333333000000000000000000000000
33333333333333333333333333333333000000003333333333333333333333333333333307555555555555700000000000000000000000000000000000000000
33333333333333333333333333333333000000003333333333333333333333333333333308555556755555800000000000000000000000000000000000000000
33337733333333333333333333333333000000003333333333333333333333333333333308555557655555800000000000000000000000000000000000000000
33337777733333333333333333333333000000003333333333333333333333333333333307555556755555700000000000000000000000000000000000000000
33777777777333333333333333333333000000003333333333333333333333333333333307555557655555700000000000000000000000000000000000000000
33777777777333333333333333333333000000003333333333333333333333333333333308555556755555800000000000000000000000000000000000000000
33377777733333333333333333333333000000003333333333333333333333333333333308555555555555800000000000000000000000000000000000000000
33333333333333333333333333333333000000003333333333333333333333333333333307555555555555700000000000000000000000000000000000000000
33333333333333333333333333333333000000000000000000000000000000000000000007555555555555700000000000000000000000000000000000000000
33333333333333333333333333333333000000000000000000000000000000000000000008555555555555800000000000000000000000000000000000000000
33333333333333333333333333333333000000000000000000000000000000000000000008555556755555800000000000000000000000000000000000000000
33333333333333333333333333333333000000000000000000000000000000000000000007555557655555700000000000000000000000000000000000000000
33333333333333333333333333333333000000000000000000000000000000000000000007555556755555700000000000000000000000000000000000000000
33333333333333337777333333333333000000000000000000000000000000000000000008555557655555800000000000000000000000000000000000000000
33333333333333377777733333333333000000000000000000000000000000000000000008555556755555800000000000000000000000000000000000000000
33333333333333377777773333333333000000000000000000000000000000000000000007555555555555700000000000000000000000000000000000000000
33333333377333377777773333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333777773777777777333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333337777777777777777333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333337777777777777777333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333337777777777777777733333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333337777777777777777733333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333777777777777777733333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333377777777777777733333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333337777777733777333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333333333333333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333333333333333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333333333333333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333333333333333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333333333333333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333333333333333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333333333333333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
101010101010101010101010101010102d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
101010101010101010101010101010102d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
101010101010101010101010101010102d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
101010101010101010101010101010102d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
101010101010101010101010101010102d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
101010101010101010101010101010102d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2020202020202020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3030303030303030303030303030303000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d1d1d1d1d1d1d1d1d1d1d1d1d1d1d1d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
