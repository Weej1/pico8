pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
local data="ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00d00008860948f70008880948c90008840948a000088309118a12510948c700088609489e00088309118c125109c600088c12518509488a0008850911941251c500088e1251850948880008850911961248c3000809ba120948c2008209ba125109c2008209bb1251c2000911bc1248c10011ad120a83090141094a88120948c000ad120a830901820041098812510948bf0088120a86094a96120a8309018a00418912510948bd0008881288094a94120a8309018c004a89125109bc00080988128209018a00418c09019300094a891251bc008209881209018c00418a0901940041094a891248bb008209881201ae0041094a88120948ba0009118812b00041098812510948b900118912b100418912510948b80089120ab2004a89125109b80088120a09b200094a891251b7000888128209b20041094a891248b500080988128209b30041094a88120948b400820988120901b400410988125109b4008209881201b60041891251b400091187120ab8004a891248b3001187120a09b800094a88120948b20088128209b80041098812510948b10088128209b900418912510948af000888120901ba004a89125109ae000809881201bb00094a891251ae0082098812bc0041094a891248ad0082098812bd0041094a88120948ac008209881248bd0041098812510948ab00820988120948bd00418912510948aa00820988125109be004a89125109aa008209891251be00094a891251aa0041094a891248bd0041094a891248aa0041094a88120948bd0041094a88120948aa0041098812510948bd00410988125109ab00418912510948bd0041891251ac004a89125109be004a8912ac00094a891251be00094a8812ac0041094a891248bd008209881248ac0041094a88120948bc00820988120948ac0041098812510948bb00410988128209ad00418912510948bb004188128209ae004a89125109bc0088128209ae00094a891251bc0088128209ae0041094a891248bb004a87125109af0041094a88120948ba00094a871251b00041098812510948b90082098812b100418912510948b80082098812b2004a89125109b8004109881248b100094a891251b9004188120948b00041098a1248b90088128209b100418a120948b80088128209b200418912510948b70088128209b300418912510948b60088128209b4004a8912510948b50088128209b400094a8912510948b40088128209b40041094a89125109b3000888128209b50041094a891251b200080988128209b60041098a1248b100820988120901b700418a120948b0008209881201b900418912510948af0082098812bb00418b1251830948aa0082098812bc004a8b1251830948a900091187120abc00094a8f12510948a6001187120a09bc0041094a8f12510948a50088128209bd0041094a9112510948a20088128209be0041094a9112510948a0000888128209bf0041094a93125109489c00080988128209c00041094a93125109489a0008820988120901c30041094a9312518509489200088309881201c50041094a9312518509489000088309118812c9004183094a99125183094884000809118d12ca004183094a99125183094882000809118d120acf0041094aac120a09d00041094aab120901d30041094aa81201d50041094aa61201d90041094aa0120a0901db0041094a9e120a0901e3004185094a8e120a0901e9004185094a8c120a0901f50041860901f90041840901ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00c6000b0f2009160c09180b2408301a3222302c2a2e202d1427"
local qmap={}
local track={}

local colors={3,4,9}
function _init()
 cls(11)
 local i=1
 local read_nibles=function(n)
 	local v=tonum("0x"..sub(data,i,i+n-1))
 	i+=n
 	return v
 end
 
 while #qmap<0x4000 do
 	-- peek data
 	local k,q=read_nibles(2)
 	-- rle or value?
 	if band(0x80,k)>0 then
 	 -- run length
 		k,q=band(0x7f,k),read_nibles(2)
 	else
 		k,q=1,k
 	end
 	for j=1,k do
 		add(qmap,q)
 	end
 end
 for k=1,read_nibles(2) do
 	add(track,{read_nibles(2),read_nibles(2)})
 end
end

local x,y=0,0
function _update()
	local dx,dy=0,0
	if(btn(0)) dx=1
	if(btn(1)) dx=-1
	if(btn(2)) dy=1
	if(btn(3)) dy=-1
	
	x+=dx
	y+=dy
end

function _draw()
 cls()
 local jmin=band(flr(y),0x7f)
	for j=1,16 do
	 local imin=band(flr(x),0x7f)
	 local idx=imin+128*jmin
		for i=1,16 do
			local q=qmap[idx]
			local hi,lo=shr(band(0b00111000,q),3),band(0b111,q)
			hi,lo=colors[hi+1],colors[lo+1]
			q=band(0x40,q)
			pal(1,hi)
			pal(14,lo)
			spr(q>0 and 2 or 1,i*8,j*8)
		 idx+=1
		end
		jmin+=1
 end
 pal()
 
 print(stat(1),2,2,7)
end
__gfx__
00000000eeeeeee11eeeeeee00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000eeeeee1111eeeeee00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700eeeee111111eeeee00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000eeee11111111eeee00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000eee1111111111eee00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700ee111111111111ee00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000e11111111111111e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
