pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
function sprite(a)
 spr(a.s,a.x,a.y)
end

fruits={
 -- cerise
 {s=18,tc=14},
 -- fraise
 {s=34,tc=14}
}
function _init()
	jeu_init(20)
	 
end

function _update()
 if mode=="perdu"then
  perdu_update()
 elseif mode=="gagne" then 
  gagne_update()
 else 
  jeu_update()
  
 end
end
function _draw()
 if mode=="perdu"then
  perdu_draw()
 elseif mode=="gagne" then
  gagne_draw()
 else
  jeu_draw()
 end
end


-->8
-- jeu
function jeu_init(t)
	x=64
	y=64
	temps=t
	mode="jeu"
	cerises={}
	mechants={}

 for i=1,10 do
  r=flr(rnd(#fruits))+1
	 cerises[i]={
	  x=8+rnd(128-16),
	  y=8+rnd(128-16),
	  fruit=fruits[r],
	  miam=false
	 }
 end
end

function jeu_update()
 temps=temps-1/30
 if(btn(1)) x=x+1
	
	if (btn(0)) x=x-1
	
	if (x>128) x=0
	
	if (x<-8) x=128
	
	if(btn(3)) y=y+1
	
	if (btn(2)) y=y-1
	
	if (y>128) y=0
	
	if (y<-8) y=128
	
	for i=1,#cerises do
	 c=cerises[i]
	 if c.miam==false then
		 l=c.x-x
		 h=c.y-y
		 d=sqrt(l*l+h*h)
		 c.dist=d
		 if d<5 then
		  c.miam=true
		  sfx(1)
		 end
		end
	end
	-- pop mechants
	if rnd()>0.9 and #mechants<5 then
	 add(mechants,{
	  s=50,x=0,y=rnd(120)})
	end  
	-- deplacement mechants
	for i=1,#mechants do 
	 m=mechants[i]
	 m.x=m.x+1
	end 
	-- gestion des modes
	if temps<=0 then
	 mode="perdu"
	 temps=0
	 sfx(0)
	else
	 totalmiam=0
	 for i=1,#cerises do
	  c=cerises[i]
	  if c.miam then 
	   totalmiam=totalmiam+1
	  end
	 end
	 if totalmiam==#cerises then
	  mode="gagne"
	  tempspause=3
	 end
	end
	  
end 

function jeu_draw()
	--cls()
	map()
	--print(x.." "..y,64,64,7)
	
	
	for i=1,#cerises do
	 c=cerises[i]
 	anim=flr(3*time()+i)%2
 	
 	palt(c.fruit.tc,true)
 	palt(0,false)

	 if c.miam then
 	 spr(20,c.x,c.y)
	 else
	  spr(c.fruit.s+anim,c.x,c.y)
	  spr(c.fruit.s+anim,c.x,c.y)
	 -- print(c.dist,c.x,c.y-8,14)
	 end
	 palt()
	end 

 anim=flr(5*time())%2
	palt(0,false)
	palt(14,true)
	
 for i=1,#mechants do
  m=mechants[i]
  spr(4,m.x,m.y+2)
  spr(50+anim,m.x,m.y)
 end 
	
	spr(4,x,y+2)
	
	spr(2+anim,x,y)
	palt()
	print(flr(temps).."''",64,2,7)
end
  

-->8
-- perdu
function perdu_update()
 if btnp(4) or btnp(5) then
  _init()
 end
end

function perdu_draw()
  jeu_draw()
  fillp(0x0f0f.f)
  rectfill(0,0,128,127,1)
  fillp()

  pal(8,2)
	 spr(8,42,61,6,1)
	 pal()
	 spr(8,42,60,6,1)
	print("appuyez sur ❎/🅾️\npour rejouer",35,75,14)
end
-->8
-- gagne
function gagne_update()
 tempspause=tempspause-1/30
 if tempspause<=0 then
  jeu_init(20-temps)
 end
end

function gagne_draw()
 jeu_draw()
 pal(8,2)
 spr(40,56,61,2,1)
 pal()
 spr(40,56,60,2,1)
 
 local t=flr(tempspause*10)/10
 print("nouvelle partie dans:"..t.."s",20,75,14)
 
 end
__gfx__
0000000000000000ee7777eeeeeeeeeeeeeeeeee1155115557777776000000000008880088880880880888800088880080000808888088880000000000000000
0000000000000000e777777eee7777eeeeeeeeee115511556dddddd7000000000080000080080808080800000800008080000808000080080000000000000000
007007000000000077077077e777777eeeeeeeee551155116dddddd7000000000800000080080800080800000800008008008008000080080000000000000000
00077000000000007707707777077077eeeeeeee551155116dddddd7000000000800880088880800080880000800008008008008800080880000000000000000
00077000000000007777777777077077eeeeeeee115511556dddddd7000000000800008080080800080800000800008008008008000088000000000000000000
00700700000000006777777777777777e000000e115511556dddddd7000000000080008080080800080800000800008000880008000080800000000000000000
0000000000000000677777776777777700000000551155116dddddd7000000000008880080080800080888800088880000880008888080080000000000000000
0000000000000000e6e6e6e66e6e6e6ee000000e551155115666666d000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000eeeeeeeeeeeeebeeeeeeeeee8888888838888888000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000eeebeeeeeeeebeeeeeeeeeee3888888883be8888000000000000000000000000000000000000000000000000000000000000000000000000
00000000000b0000eeeebeeeeee88eeeeeeeeeee83be88888322e888000000000000000000000000000000000000000000000000000000000000000000000000
0000000000889000eee88eeeee8878eeeeeeeeee8322e88881222ee8000000000000000000000000000000000000000000000000000000000000000000000000
0000000008988800ee8878eeee2888eeeeeeeeee81222ee88812222e000000000000000000000000000000000000000000000000000000000000000000000000
0000000002888900ee2888eeeee28eeebeee8eee8812222e88812222000000000000000000000000000000000000000000000000000000000000000000000000
0000000000292000ee0280eeee0000eeeeee3eee8881222288881118000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000eee00eeeeee00eeeee8eee8e8000111088000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000eeeeeeeeeeeeeeeeeeeeeeeeee9999eeeeeeeeee000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000eeeeeeeeeeebeeeeee9999eee977779eeeeeeeee000000008000808088800080000000000000000000000000000000000000000000000000
0000000000000000eeebeeeeee889eeee977779ee977679eeeee999e000000008000808080080080000000000000000000000000000000000000000000000000
0000000000000000ee889eeee89888eee977679ee976679ee9ee900e000000008000808080080080000000000000000000000000000000000000000000000000
0000000000000000e89888eee28889eee976679ee477779e499e499e000000008080808080080000000000000000000000000000000000000000000000000000
0000000000000000e28889eeee292eeee477779eee4499ee040e009e000000000888008080080080000000000000000000000000000000000000000000000000
0000000000000000e02920eee00000eee044990ee000000ee0ee444e000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000ee000eeeee000eeeee0000eeee0000eeeeee000e000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000eeeeeeeee33eebbe000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000e33eebbee3bbbbbe000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000e3bbbbbeeb0bb0be000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000eb0bb0bee3bbbbbe000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000e3bbbbbeee3bbbee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000ee3bbbeeee333bee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000ee333beeee3ee3ee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000ee3ee3eeeeeeeeee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0505050505050505050505050505050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000500000000029050275502615026050250502355024050220501f1501e0501b5501a05019050180501615015050155501205011050100500e1500d0500c0500955008050060500305001550001500005025000
000300001a4501e450154000b6000b5000b5000b6000b5000b6000d5000b6000d5000b6000b6000b6000c6000c6000c6000c6000e6000830008300000000000000000133000e3000000000000000000930008300
000c00000d5200d5200d520095200752006520085200b5200f5201052007520075200752007520075200b5200a5300a5300a53009530095300f5301b530135300b5300b5300b5300a53009530085201352012520
000d00001076014760187501a7401a74019740167401274011740107400f7400f7300f7100f7100f7101072012730157401774017750167501574015730187301a7501a760177501575014750177701777017750
__music__
03 00010302

